<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>DINO 27 | LOOKBOOK & MARCHÃ‰ NOIR</title>
    <style>
        body { background: #ffffff; color: #1a1a1a; font-family: "Times New Roman", serif; margin: 0; transition: 1s; overflow-x: hidden; }
        .currency-bar { position: fixed; top: 0; width: 100%; background: #000; color: #d4af37; padding: 12px 30px; text-align: right; z-index: 1000; font-size: 14px; letter-spacing: 2px; box-sizing: border-box; border-bottom: 1px solid #d4af37; }
        .header-section { text-align: center; padding: 100px 20px 50px; }
        .header-section h1 { font-size: 60px; font-weight: 100; letter-spacing: 10px; margin: 0; }
        .magazine-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 40px; padding: 0 60px 100px; max-width: 1400px; margin: 0 auto; }
        .showcase { position: relative; background: #fff; overflow: hidden; transition: 0.4s; border-bottom: 1px solid #eee; padding-bottom: 20px; }
        .img-box { width: 100%; aspect-ratio: 3/4; overflow: hidden; cursor: pointer; position: relative; background: #f9f9f9; }
        .img-box img { width: 100%; height: 100%; object-fit: cover; transition: 0.8s; }
        .sold-out-tag { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: red; font-weight: bold; font-size: 28px; border: 4px solid red; padding: 10px; display: none; z-index: 10; background: rgba(255,255,255,0.9); letter-spacing: 2px; }
        .black-market-trigger { position: fixed; right: -45px; top: 50%; transform: rotate(-90deg); background: #000; color: #fff; padding: 10px 25px; cursor: pointer; z-index: 2000; letter-spacing: 3px; font-size: 12px; transition: 0.3s; }
        .black-market-trigger:hover { background: #d4af37; color: #000; }
        .market-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; color: #d4af37; display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 3000; text-align: center; }
        .terminal { border: 1px solid #333; padding: 50px; max-width: 600px; background: #050505; box-shadow: 0 0 30px rgba(212,175,55,0.1); }
        .btn { border: 1px solid #d4af37; background: none; color: #d4af37; padding: 12px 25px; cursor: pointer; margin: 10px; font-family: serif; transition: 0.3s; }
        .btn:hover { background: #d4af37; color: #000; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="currency-bar">FISH COINS: <span id="fish-coin">3</span> ğŸŸ</div>
<div class="black-market-trigger" onclick="enterMarket()">LE MARCHÃ‰ NOIR</div>

<div id="mag-view">
    <div class="header-section">
        <h1>DINO 27</h1>
        <p>THE 2026 MILANO COLLECTION</p>
    </div>
    <div class="magazine-grid" id="grid-container"></div>
</div>

<div id="market" class="market-overlay">
    <div class="terminal">
        <div id="story-content" style="margin-bottom:30px; line-height:1.8; font-size: 18px;">ä½ å‰›è¸é€²é»‘å¸‚æ·±è™•ï¼Œå°±è¢«æ””ä¸‹ã€‚<br><br>ã€Œåœ‹ç‹çš„ç”Ÿæ—¥ï¼Ÿã€</div>
        <div id="quiz-area" class="hidden">
            <p id="question-text" style="font-size:20px; color:#d4af37; margin-bottom: 25px;"></p>
            <div id="options-box"></div>
        </div>
        <div id="market-actions">
            <button class="btn" id="start-btn" onclick="nextStage()">ACCEPT CHALLENGE</button>
            <button class="btn" style="border-color:#666; color:#666;" onclick="leaveMarket()">LEAVE (EXIT TO 3 ğŸŸ)</button>
        </div>
    </div>
</div>

<script>
    // é…ç½®å€åŸŸ
    const STOCK_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTwOll10EJ23JtCAxUzRtOY6r8yW0yc0Tgn9TyuloPl4pR1lPuuVK5iOpV1KmAkaY4kSq1Jcj6OiQP0/pub?gid=488908997&single=true&output=csv";
    const MAG_FORM = "https://docs.google.com/forms/d/e/1FAIpQLScWck40_ZDTAutZ6PT6cq3koXbHUyplsl8lcoASe2ACTlZXOg/viewform";
    const MARKET_FORM = "https://docs.google.com/forms/d/e/1FAIpQLScv7hqzJEcDXYX7BpIEfs5c2NmNfLOpUnWIxa1blxE9gU9afw/viewform";
    const MAG_ENTRY_ID = "entry.94643144"; 
    const MARKET_ENTRY_ID = "entry.94782409"; 

    let coins = 3;
    let stage = 0;
    let hasLeftMarket = false;
    let inventory = Array(17).fill(2); 

   // 1. åŒæ­¥åº«å­˜
async function syncStock() {
    try {
        const res = await fetch(STOCK_CSV_URL);
        const text = await res.text();
        // å»ºè­°åŠ ä¸Š trim() è™•ç†æ›è¡Œç¬¦è™Ÿå•é¡Œ
        const rows = text.split('\n').slice(1);
        
        rows.forEach(row => {
            const cols = row.split(',');
            if (cols.length >= 3) { // ç¢ºä¿é€™è¡Œè‡³å°‘æœ‰ä¸‰æ¬„
                const id = parseInt(cols[0]);    // Aæ¬„: ID
                const count = parseInt(cols[2]); // ä¿®æ”¹é€™è£¡ï¼å¾ cols[1] æ”¹æˆ cols[2] (è®€å– C æ¬„)
                
                if(!isNaN(id)) {
                    inventory[id] = isNaN(count) ? 0 : count; 
                }
            }
        });
        renderGrid();
    } catch (e) { 
        console.log("Stock Sync Error", e); 
        renderGrid(); 
    }
}

    // 2. æ¸²æŸ“é›œèªŒ
    function renderGrid() {
        const grid = document.getElementById('grid-container');
        grid.innerHTML = "";
        for(let i=1; i<=16; i++) {
            const isSoldOut = inventory[i] <= 0;
            grid.innerHTML += `
                <div class="showcase" style="${isSoldOut ? 'opacity:0.5' : ''}">
                    <div class="img-box" onclick="${isSoldOut ? '' : `buyItem(${i})`}">
                        <div class="sold-out-tag" style="${isSoldOut ? 'display:block' : ''}">SOLD OUT</div>
                        <img src="cloth${i}.jpg">
                    </div>
                    <div class="info-box">
                        <h3>PIÃˆCE #${i}</h3>
                        <p style="color:#d4af37">STOCK: ${inventory[i]}</p>
                    </div>
                </div>
            `;
        }
    }

    // 3. é›œèªŒè³¼è²· (è‡ªå‹•å‹¾é¸ç¶²å€)
    function buyItem(id) {
        if(coins < 3) { alert("é­šå¹£ä¸è¶³ã€‚æˆ–è¨±å»é»‘å¸‚æ‰¾æ‰¾æ©Ÿæœƒï¼Ÿ"); return; }
        if(confirm(`ç¢ºå®šè¦æ¶ˆè€— 3 é­šå¹£è³¼è²·ç³»åˆ— #${id}ï¼Ÿ\nç¢ºèªå¾Œå°‡è·³è½‰è‡³è¨‚è³¼è¡¨å–®ä¸¦è‡ªå‹•å‹¾é¸ã€‚`)) {
            const prefillUrl = `${MAG_FORM}?usp=pp_url&${MAG_ENTRY_ID}=%23${id}`;
            window.open(prefillUrl);
        }
    }

    // 4. é»‘å¸‚é‚è¼¯
    const questions = [
        { q: "å•é¡Œ 1ï¼šæç‡¦çš„ç”Ÿæ—¥æ˜¯å¹¾è™Ÿï¼Ÿ", a: ["2/10", "2/11", "2/12", "3/11"], correct: 1, story: "ä½ è¢«æ”¾è¡Œäº†ã€‚\nç‰†ä¸Šè²¼è‘—èˆŠæµ·å ±ï¼šã€é¡å­è£¡æ‰€ç…§çš„æˆ‘ååˆ†é™Œç”Ÿã€‚ã€" },
        { q: "å•é¡Œ 2ï¼šæç‡¦æˆå¹´é«˜ä¸­ç•¢æ¥­çš„Soloæ›²æ˜¯ï¼Ÿ", a: ["Wait", "Last Order", "Zero", "High Five"], correct: 2, story: "ç‡¦å™ å“©æƒ³èµ·ç¬¬ä¸€æ¬¡çš„ solo mv æ‹æ”ï¼šã€ä½†ä½ ä¸æ˜¯ä¸€å€‹äººã€‚ã€" },
        { q: "å•é¡Œ 3ï¼šã€ŠWaitã€‹èŠ±çµ® MVæ‹æ”æ™‚ï¼Œæœ‰å¹¾ä½å“¥å“¥åˆ°å ´åŠ æ²¹ï¼Ÿ", a: ["10", "11", "12", "13"], correct: 2, story: "å“¥å“¥å€‘éƒ½ä¾†äº†ï¼å±•ç¤ºæ¶ä¸Šæ”¾è‘—æ¼”å”±æœƒæœè£ã€‚" },
        { q: "å•é¡Œ 4ï¼šRain èˆå°ç¬¬ä¸€å¤©èˆ‡ç¬¬äºŒå¤©æœ‰ä½•è™•ä¸åŒï¼Ÿ", a: ["é‹å­", "æ‰‹å¥—", "è‡‚ç’°", "éº¥å…‹é¢¨"], correct: 2, story: "åœ‹ç‹å¹«å“¥å“¥è¨­è¨ˆèˆè¹ˆã€‚ç§‹å¤©çš„è½è‘‰å¥½å¤šã€‚" },
        { q: "å•é¡Œ 5ï¼šDino Danceology ä¸­ï¼Œå’ŒçŸ¥ç§€ä¸€èµ·çš„é‚£æ”¯èˆï¼Œæ˜¯åœ¨å“ªè£¡æ‹æ”çš„ï¼Ÿ", a: ["æ±äº¬", "å¤§é˜ª", "é¦–çˆ¾", "åå¤å±‹"], correct: 3, story: "é»‘å¸‚è²éŸ³æ¶ˆå¤±ï¼šã€é‚£æ˜¯ç¬¬ä¸€æ¬¡ç¨è‡ªä¸€äººç«™ä¸Šçš„åœ‹éš›èˆå°...ã€" },
        { q: "å•é¡Œ 6ï¼šæç‡¦ä»Šå¹´ç¨è‡ªå‡ºåœ‹è¡¨æ¼”æ˜¯å»ï¼Ÿ", a: ["æ—¥æœ¬", "ç¾åœ‹", "æ²™çƒåœ°(EWC)", "æ³•åœ‹"], correct: 2, story: "é–€å‰çš„äººç¿»è‘—è³‡æ–™ï¼šã€ä»Šå¹´ï¼Œæç‡¦èµ°å‡ºäº†å¤šå°‘æ¬¡éšŠä¼ä»¥å¤–ï¼Ÿã€" },
        { q: "å•é¡Œ 7ï¼šæç‡¦ 2025å¹´å…±æœ‰å¹¾æ¬¡ã€ŒéšŠå¤–ã€åˆä½œï¼Ÿ", a: ["4æ¬¡", "5æ¬¡", "6æ¬¡", "7æ¬¡"], correct: 2, story: "ä½ ä¾†åˆ°æœ€æ·±è™•ã€‚æ¡Œä¸Šæ”¤è‘—ä¸€æœ¬ã€Šæ°´çºè§€å¯Ÿæ—¥è¨˜ã€‹ã€‚" },
        { q: "å•é¡Œ 8ï¼šæ—¥è¨˜ä¸­ã€Œæ²’æœ‰ã€æ”¶éŒ„ä»¥ä¸‹å“ªå€‹å‹•ä½œï¼Ÿ", a: ["é¼“å˜´", "æ‚è‡‰", "éœ²é½’ç¬‘", "çœ¼é¡"], correct: 3, story: "ã€æœ‰ä¸€å€‹é¡è‰²ï¼Œåªæœ‰ä½ èƒ½æ’å¾—ä½ã€‚ã€" },
        { q: "å•é¡Œ 9ï¼šè¨­è¨ˆå¸«æœ€å–œæ­¡æç‡¦çš„å“ªä¸€å€‹é«®è‰²ï¼Ÿ", a: ["é»‘è‰²", "é‡‘è‰²", "ç´…è‰²", "è—è‰²"], correct: 3, story: "é–€ï¼Œåœ¨ä½ é¢å‰æ‰“é–‹ã€‚è¨­è¨ˆå¸«å°±åœ¨è£¡é¢ã€‚" }
    ];

    function showQuestion() {
        if(stage < questions.length) {
            const q = questions[stage];
            document.getElementById('question-text').innerText = q.q;
            const btnBox = document.getElementById('options-box'); btnBox.innerHTML = "";
            q.a.forEach((opt, i) => {
                const b = document.createElement('button'); b.className = "btn"; b.innerText = opt;
                b.onclick = () => {
                    if(i === q.correct) { coins += 2; alert("æ­£ç¢ºã€‚ç²å¾— 2 é­šå¹£ã€‚"); }
                    else { alert("ç­”éŒ¯äº†ã€‚ä½†ä½ çš„å …æŒè®“è¨­è¨ˆå¸«å¿ƒè»Ÿäº†..."); }
                    document.getElementById('story-content').innerText = q.story;
                    stage++; document.getElementById('fish-coin').innerText = coins; showQuestion();
                };
                btnBox.appendChild(b);
            });
            const exitBtn = document.createElement('button');
            exitBtn.className = "btn"; exitBtn.style.color="#666"; exitBtn.innerText = "LEAVE (é€€å› 3 ğŸŸ)";
            exitBtn.onclick = leaveMarket; btnBox.appendChild(exitBtn);
        } else {
            document.getElementById('market-actions').style.display = 'none';
            document.getElementById('quiz-area').innerHTML = `<h2>æŒ‘æˆ°å®Œæˆ</h2><p>æœ€çµ‚é­šå¹£ï¼š${coins}</p><button class="btn" onclick="window.location.href='${MARKET_FORM}?usp=pp_url&${MARKET_ENTRY_ID}=${coins}'">å‰å¾€æäº¤ç±Œç¢¼</button>`;
        }
    }

    function enterMarket() { if(!hasLeftMarket) document.getElementById('market').style.display='flex'; }
    function nextStage() { document.getElementById('start-btn').classList.add('hidden'); document.getElementById('quiz-area').classList.remove('hidden'); showQuestion(); }
    function leaveMarket() {
        if(confirm("ç¢ºå®šé›¢é–‹ï¼Ÿé­šå¹£é‡ç½®ç‚º 3 ä¸”ç„¡æ³•å†å›ä¾†ã€‚")) {
            coins = 3; hasLeftMarket = true; document.getElementById('market').style.display='none';
            document.getElementById('fish-coin').innerText = coins;
            const trigger = document.querySelector('.black-market-trigger');
            trigger.innerText = "FERMÃ‰ (å·²é—œé–‰)"; trigger.style.background = "#444";
        }
    }
    syncStock();
</script>
</body>

</html>

