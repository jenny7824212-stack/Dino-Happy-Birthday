<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DINO 27 æ­²ç”Ÿæ—¥æ‡‰æ´ç«™</title>
    <style>
        body { background: #222222; color: #ffffff; font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; margin: 0; overflow-x: hidden; }
        header { padding: 40px 20px; text-align: center; border-bottom: 1px solid #444; letter-spacing: 5px; background: #1a1a1a; }
        header h1 { margin: 0; font-size: 24px; color: #fff; }
        header p { color: #888; font-size: 12px; margin-top: 10px; }

        .nav-bar { display: flex; justify-content: space-between; padding: 12px 20px; border-bottom: 1px solid #444; font-size: 13px; position: sticky; top: 0; background: rgba(26, 26, 26, 0.9); backdrop-filter: blur(10px); z-index: 100; color: #ccc; }
        
        .refresh-container { text-align: center; padding: 15px; }
        #refresh-btn { background: transparent; border: 1px solid #666; color: #ccc; padding: 8px 20px; cursor: pointer; font-size: 11px; transition: 0.3s; }
        #refresh-btn:hover { background: #fff; color: #000; border-color: #fff; }

        #floating-market-btn { 
            position: fixed; bottom: 30px; right: 30px; 
            background: #ffffff; color: #000000; padding: 18px 25px; 
            border-radius: 50px; cursor: pointer; z-index: 999; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); border: none; 
            letter-spacing: 4px; font-weight: bold; font-size: 16px; 
            transition: 0.3s;
        }
        #floating-market-btn:hover { transform: scale(1.1); }
        #floating-market-btn.disabled { background: #444; color: #777; cursor: not-allowed; transform: none; box-shadow: none; }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 30px; padding: 40px 20px; }
        .item { border: 1px solid #333; padding: 15px; text-align: center; position: relative; background: #1a1a1a; border-radius: 2px; transition: 0.3s; }
        .item:hover { border-color: #666; transform: translateY(-5px); }
        .item img { width: 100%; height: auto; } 
        .item img:hover { filter: grayscale(0%); }
        .item h3 { font-size: 15px; margin: 15px 0 5px; letter-spacing: 2px; color: #eee; }
        .item p { font-size: 12px; color: #777; margin-bottom: 10px; }
        
        .sold-out { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); color: #fff; display: flex; align-items: center; justify-content: center; z-index: 10; pointer-events: none; font-weight: bold; letter-spacing: 2px; }

        #black-market-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; color: #fff; z-index: 1000; padding: 40px 20px; box-sizing: border-box; overflow-y: auto; }
        .quiz-container { max-width: 600px; margin: 20px auto; }
        .option-btn { display: block; width: 100%; padding: 18px; margin: 12px 0; border: 1px solid #444; background: #111; color: #fff; cursor: pointer; text-align: left; font-size: 16px; transition: 0.3s; }
        .option-btn:hover { background: #fff; color: #000; border-color: #fff; }
        #quiz-story { font-style: italic; color: #888; margin-bottom: 25px; white-space: pre-line; line-height: 1.8; font-size: 15px; }
        #quiz-question { font-size: 18px; line-height: 1.6; font-weight: bold; color: #fff; margin-bottom: 20px; }
        
        #closed-message { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#000; color:#fff; z-index:9999; justify-content:center; align-items:center; font-size:20px; text-align:center; letter-spacing:2px; }
    </style>
</head>
<body>

<div id="closed-message">æ´»å‹•å·²çµæŸ / EVENT CLOSED<br><span style="font-size:14px; color:#666; margin-top:10px;">æ„Ÿè¬æ‚¨çš„åƒèˆ‡</span></div>

<header>
    <h1>DINO 27TH BIRTHDAY</h1>
    <p>SPECIAL COLLECTION EXHIBITION</p>
</header>

<div class="nav-bar" id="top-nav">
    <div>FISHER COIN: <span id="coin-count">3</span> ğŸŸ</div>
    <div>STATUS: <span id="sync-indicator">ğŸŸ¢ CONNECTED</span></div>
</div>

<div class="refresh-container">
    <button id="refresh-btn" onclick="manualRefresh()">SYNC INVENTORY</button>
</div>

<div id="floating-market-btn" onclick="openMarket()">{ é»‘å¸‚ }</div>

<div class="grid" id="magazine-grid"></div>

<div id="black-market-overlay">
    <div class="quiz-container">
        <h2 style="letter-spacing:5px;">BLACK MARKET</h2>
        <hr border="1" color="#333" style="margin-bottom:30px;">
        <p id="quiz-story"></p>
        <p id="quiz-question"></p>
        <div id="quiz-options"></div>
        <div id="quiz-footer" style="margin-top: 40px; font-size: 12px; color: #444; text-align: center;">
            <span onclick="confirmCloseMarket()" style="cursor:pointer; text-decoration: underline;">[ LEAVE MARKET ]</span>
        </div>
    </div>
</div>

<script>
    // --- 1. é…ç½®èˆ‡é€£çµ ---
    const STOCK_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTwOll10EJ23JtCAxUzRtOY6r8yW0yc0Tgn9TyuloPl4pR1lPuuVK5iOpV1KmAkaY4kSq1Jcj6OiQP0/pub?gid=488908997&single=true&output=csv';
    const BLACK_MARKET_FORM_URL = 'https://docs.google.com/forms/d/e/1FAIpQLScv7hqzJEcDXYX7BpIEfs5c2NmNfLOpUnWIxa1blxE9gU9afw/viewform';
    const ORDER_FORM_URL = 'https://docs.google.com/forms/d/e/1FAIpQLScWck40_ZDTAutZ6PT6cq3koXbHUyplsl8lcoASe2ACTlZXOg/viewform';
    const CLOSE_DATE = new Date("Feb 12, 2026 00:00:00").getTime(); 

    // --- 2. ç‹€æ…‹åˆå§‹åŒ– (å¾ LocalStorage è®€å–) ---
    const urlParams = new URLSearchParams(window.location.search);
    const isPreviewMode = urlParams.get('mode') === 'preview';
    const isDeveloper = urlParams.get('dev') === 'otter921008'; 

    // é­šå¹£ï¼šåˆå§‹ 3 æšï¼Œè‹¥æœ‰ç´€éŒ„å‰‡è®€å–ç´€éŒ„
    let coins = localStorage.getItem('dino_coins') !== null ? parseInt(localStorage.getItem('dino_coins')) : 3;
    // è³¼è²·ç´€éŒ„ï¼šç´€éŒ„æ˜¯å¦å·²è²·é
    let hasOrdered = localStorage.getItem('dino_ordered') === 'true';

    let inventory = {};
    let currentQuiz = -1;

    // --- 3. åˆå§‹åŒ–é é¢é¡¯ç¤º ---
    function initMode() {
        const topNav = document.getElementById('top-nav');
        if (isPreviewMode) {
            document.getElementById('floating-market-btn').style.display = 'none';
            document.getElementById('refresh-btn').style.display = 'none';
            topNav.innerHTML = `
                <div style="cursor:pointer; text-decoration:underline; font-weight:bold; color:#fff;" onclick="window.location.href='index.html'">â† è¿”å›å…¥å£ BACK</div>
                <div style="color:#888; letter-spacing:2px;">PREVIEW MODE</div>
                <div></div>
            `;
        } else {
            // æ›´æ–°é­šå¹£é¡¯ç¤º
            document.getElementById('coin-count').innerText = coins;
            checkMarketStatus();
        }
    }

    // æª¢æŸ¥é»‘å¸‚é€²å…¥è³‡æ ¼
    function checkMarketStatus() {
        const hasEntered = localStorage.getItem('dino_market_entered');
        const btn = document.getElementById('floating-market-btn');
        if (hasEntered === 'true' && !isDeveloper) {
            btn.innerHTML = "{ é»‘å¸‚å·²é—œé–‰ }";
            btn.classList.add('disabled');
            btn.onclick = function() { alert("æ©Ÿæœƒåªæœ‰ä¸€æ¬¡ï¼Œé»‘å¸‚å¤§é–€å·²é—œé–‰ã€‚"); };
        }
    }

    // åº«å­˜åŒæ­¥èˆ‡æ¸²æŸ“
    async function syncStock() {
        try {
            const res = await fetch(`${STOCK_CSV_URL}&t=${new Date().getTime()}`);
            const text = await res.text();
            const rows = text.split('\n').filter(r => r.trim() !== '').slice(1);
            rows.forEach(row => {
                const cols = row.split(',');
                if (cols.length >= 3) {
                    const id = parseInt(cols[0]);
                    const count = parseInt(cols[2]);
                    if (!isNaN(id)) inventory[id] = count;
                }
            });
            renderGrid();
        } catch (e) { console.error("Sync Failed"); }
    }

    function renderGrid() {
        const grid = document.getElementById('magazine-grid');
        grid.innerHTML = '';
        for (let i = 1; i <= 16; i++) {
            const stock = inventory[i] !== undefined ? inventory[i] : '...';
            const isSoldOut = (stock !== '...' && stock <= 0);
            const item = document.createElement('div');
            item.className = 'item';
            
            // å¦‚æœå·²è³¼è²·éï¼Œé»æ“Šæœƒè§¸ç™¼å·²è³¼è²·æç¤ºï¼Œå¦å‰‡åŸ·è¡Œ orderItem
            const clickAction = isPreviewMode ? "" : (isSoldOut ? "" : `orderItem(${i})`);
            const cursor = isPreviewMode ? "default" : (isSoldOut ? "default" : "pointer");

            item.innerHTML = `
                <img src="cloth${i}.jpg" style="cursor: ${cursor};" onclick="${clickAction}">
                <h3>ITEM #${String(i).padStart(3, '0')}</h3>
                <p style="color:#aaa; font-size:11px;">PRICE: 3 ğŸŸ</p>
                <p>STOCK: ${stock}</p>
                ${isSoldOut ? '<div class="sold-out">SOLD OUT</div>' : ''}
            `;
            grid.appendChild(item);
        }
    }

    // --- 4. è³¼è²·é‚è¼¯ (æ‰£é™¤ 3 å¹£ & é™è³¼ä¸€é …) ---
    function orderItem(id) {
        if (hasOrdered && !isDeveloper) {
            alert("è£ç¸«å¸«æé†’ï¼šæ¯äººé™è³¼ä¸€ä»¶çè—ï¼Œä½ å·²ç¶“æŒ‘é¸éå›‰ï¼");
            return;
        }
        if (coins < 3) {
            alert("ä½ çš„é­šå¹£ä¸è¶³ï¼è³¼è²·æœè£éœ€è¦ 3 æšé­šå¹£ã€‚");
            return;
        }

        if (confirm(`ç¢ºå®šè¦æ¶ˆè€— 3 æšé­šå¹£å…Œæ› ITEM #${String(id).padStart(3, '0')} å—ï¼Ÿ\n(å…Œæ›å¾Œå‰©é¤˜é­šå¹£å°‡ä¿ç•™ç”¨æ–¼æŠ½çåŠ æ¬Š)`)) {
            coins -= 3;
            hasOrdered = true;
            
            // å­˜æª”è‡³ LocalStorage
            localStorage.setItem('dino_coins', coins);
            localStorage.setItem('dino_ordered', 'true');
            
            // æ›´æ–°ç•«é¢
            document.getElementById('coin-count').innerText = coins;
            
            const formattedId = "#" + id;
            window.open(`${ORDER_FORM_URL}?usp=pp_url&entry.94643144=${encodeURIComponent(formattedId)}`);
            renderGrid();
        }
    }

    // --- 5. é»‘å¸‚é‚è¼¯ (ç­”å°å­˜æª”) ---
    const questions = [
        { story: "ä½ å‰›è¸é€²é»‘å¸‚æ·±è™•,å°±è¢«æ””ä¸‹ã€‚\nå°æ–¹æ²’æœ‰è³ªå•,åªæ˜¯éœéœçœ‹è‘—ä½ ã€‚\nã€Œåœ‹ç‹çš„ç”Ÿæ—¥?ã€", q: "å•é¡Œ 1ï¼šæç‡¦çš„ç”Ÿæ—¥æ˜¯å¹¾è™Ÿ?", a: ["2/10", "2/11", "2/12", "3/11"], correct: 1 },
        { story: "ä½ è¢«æ”¾è¡Œäº†ã€‚\nç‰†ä¸Šè²¼è‘—èˆŠèˆå°æµ·å ±,ä¸Šé¢ä¸€ä¸²æ–‡å­—:\nã€Œé¡å­è£¡æ‰€ç…§çš„æˆ‘ååˆ†é™Œç”Ÿã€‚ã€", q: "å•é¡Œ 2ï¼šæç‡¦æˆå¹´é«˜ä¸­ç•¢æ¥­çš„Soloæ›²æ˜¯?", a: ["Wait", "Last Order", "Zero", "High Five"], correct: 2 },
        { story: "ç‡ˆå…‰çŸ­æš«äº®èµ·ã€‚\nç‡¦å™ å“©æƒ³èµ·ç¬¬ä¸€æ¬¡çš„solo mixtape mv æ‹æ”ã€‚\nã€Œä½†ä½ ä¸æ˜¯ä¸€å€‹äººã€‚ã€", q: "å•é¡Œ 3ï¼šã€ŠWaitã€‹èŠ±çµ® MVæ‹æ”æ™‚,æœ‰å¹¾ä½å“¥å“¥åˆ°å ´åŠ æ²¹?", a: ["10", "11", "12", "13"], correct: 2 },
        { story: "å“¥å“¥å€‘éƒ½ä¾†å¹«åœ‹ç‹åŠ æ²¹å•¦ã€‚\nç¶“éä¸€æ’å±•ç¤ºæ¶,ä¸Šé¢æ”¾è‘—æ¼”å”±æœƒæœè£ã€‚", q: "å•é¡Œ 4ï¼šSEVENTEEN RIGHT HEREæ¼”å”±æœƒã€ŒéŸ“åœ‹å ´ã€Rainèˆå°ç¬¬ä¸€å¤©èˆ‡ç¬¬äºŒå¤©è¡¨æ¼”æœ‰ä½•ä¸åŒ?", a: ["é‹å­", "æ‰‹å¥—", "è‡‚ç’°", "éº¥å…‹é¢¨"], correct: 2 },
        { story: "è¢å¹•äº®èµ·,ä¸€æ®µç†Ÿæ‚‰çš„èˆè¹ˆç•«é¢å‡ºç¾ã€‚\nåœ‹ç‹å¹«å“¥å“¥çš„soloæ›²è¨­è¨ˆèˆè¹ˆã€‚\nç§‹å¤©çš„è½è‘‰å¥½å¤šã€‚", q: "å•é¡Œ 5ï¼šDino Danceologyä¸­,å’ŒçŸ¥ç§€ä¸€èµ·çš„é‚£æ”¯èˆæ˜¯åœ¨å“ªè£¡æ‹æ”çš„?", a: ["æ±äº¬", "å¤§é˜ª", "é¦–çˆ¾", "åå¤å±‹"], correct: 3 },
        { story: "ä½ å†å¾€è£¡èµ°,é»‘å¸‚çš„è²éŸ³é€æ¼¸æ¶ˆå¤±ã€‚\nåªå‰©ä¸‹ä¸€å¥å•é¡Œ,åœ¨ç©ºé–“è£¡å›ç›ªã€‚\nã€Œç¬¬ä¸€æ¬¡èº«æ—æ²’æœ‰æˆå“¡ç«™ä¸Šäº†ä½•è™•çš„åœ‹éš›èˆå°?ã€", q: "å•é¡Œ 6ï¼šæç‡¦ä»Šå¹´ç¨è‡ªä¸€äººå‡ºåœ‹è¡¨æ¼”,æ˜¯å»å“ªè£¡?", a: ["æ—¥æœ¬", "ç¾åœ‹", "æ²™çƒåœ°é˜¿æ‹‰ä¼¯", "æ³•åœ‹"], correct: 2 },
        { story: "é‚£ä¸€åˆ»,ç©ºæ°£è®Šå¾—å¾ˆå®‰éœã€‚\né–€å‰çš„äººç¿»è‘—è³‡æ–™,èªæ°£ä¸åƒç›¤å•,æ›´åƒç¢ºèªã€‚\nã€Œä»Šå¹´,æç‡¦èµ°å‡ºäº†å¤šå°‘æ¬¡ã€éšŠä¼ä»¥å¤–ã€?ã€", q: "å•é¡Œ 7ï¼šæç‡¦ 2026å¹´å…±æœ‰å¹¾æ¬¡ã€ŒéšŠå¤–ã€åˆä½œ? (BSSã€HxWã€CxMåŠå®¶äººåˆä½œè¨ˆå…¥éšŠå…§)", a: ["4 æ¬¡", "5 æ¬¡", "6 æ¬¡", "7 æ¬¡"], correct: 2 },
        { story: "ä»–é—”ä¸Šè³‡æ–™ã€‚ä½ çµ‚æ–¼ä¾†åˆ°æœ€æ·±è™•ã€‚\næ¡Œä¸Šæ”¤è‘—ä¸€æœ¬ç¿»èˆŠçš„å†Šå­ã€‚\nå°é¢å¯«è‘—â€”â€”ã€Šæ°´çºè§€å¯Ÿæ—¥è¨˜ã€‹", q: "å•é¡Œ 8ï¼šä»¥ä¸‹å“ªä¸€å€‹ã€Œæ²’æœ‰ã€è¢«æ”¶éŒ„åœ¨hys_921008ã€Šæ°´çºè§€å¯Ÿæ—¥è¨˜ã€‹ä¸­?", a: ["é¼“å˜´", "æ‚è‡‰", "éœ²é½’ç¬‘", "çœ¼é¡"], correct: 3 },
        { story: "ç‡¦å™ å“©ç™¼ç¾è¨­è¨ˆå¸«æœ€å–œæ­¡å¹¸ç¦çš„å°æ°´çºã€‚\nç‰†ä¸Šè²¼æ»¿å‰ªå ±,å¹¾ä¹éƒ½æ˜¯åŒä¸€å€‹è‰²ç³»ã€‚\nã€Œæœ‰ä¸€å€‹é¡è‰²ååˆ†è€€çœ¼ã€‚ã€", q: "å•é¡Œ 9ï¼šæ°´çºè£ç¸«å¸«æœ€å–œæ­¡æç‡¦çš„å“ªä¸€å€‹é«®è‰²?", a: ["é»‘è‰²", "é‡‘è‰²", "ç´…è‰²", "è—è‰²"], correct: 3 }
    ];

    function openMarket() {
        if (localStorage.getItem('dino_market_entered') === 'true' && !isDeveloper) {
            alert("æ©Ÿæœƒåªæœ‰ä¸€æ¬¡ï¼Œé»‘å¸‚å¤§é–€å·²é—œé–‰ã€‚");
            return;
        }
        if (!isDeveloper) { localStorage.setItem('dino_market_entered', 'true'); }
        checkMarketStatus();
        document.getElementById('black-market-overlay').style.display = 'block';
        currentQuiz = -1;
        showQuestion();
    }

    function showQuestion() {
        const storyP = document.getElementById('quiz-story');
        const questionP = document.getElementById('quiz-question');
        const optionsDiv = document.getElementById('quiz-options');

        if (currentQuiz === -1) {
            storyP.innerText = "å°‹æ‰¾å‚³èªªä¸­çš„è¨­è¨ˆå¸«â€”â€”æ°´çºè£ç¸«å¸«ã€‚";
            questionP.innerHTML = `å”¯æœ‰è­‰æ˜ä½ å°æç‡¦çš„äº†è§£ï¼Œæ‰èƒ½è¦‹åˆ°ä»–çš„çœŸé¢ç›®ã€‚<br>
                                   <span style="font-size:12px; color:#aaa; font-weight:normal;">(è‹¥éœ€è¿”å›é›œèªŒé é¢ï¼Œè«‹é»æ“Šä¸‹æ–¹ [ LEAVE MARKET ])</span>`;
            optionsDiv.innerHTML = `<button class="option-btn" onclick="currentQuiz=0; showQuestion();">é–‹å§‹å°‹æ‰¾ / START SEARCHING</button>`;
            return;
        }
        if (currentQuiz >= questions.length) { finishMarket(); return; }
        const data = questions[currentQuiz];
        storyP.innerText = data.story;
        questionP.innerText = data.q;
        optionsDiv.innerHTML = '';
        data.a.forEach((txt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = `${String.fromCharCode(65 + idx)}. ${txt}`;
            btn.onclick = () => checkAnswer(idx);
            optionsDiv.appendChild(btn);
        });
    }

    function checkAnswer(idx) {
        if (idx === questions[currentQuiz].correct) {
            coins += 2; 
            document.getElementById('coin-count').innerText = coins;
            localStorage.setItem('dino_coins', coins); // ç­”å°ç«‹å³å­˜æª”
            alert("æ­£ç¢ºï¼ç²å¾— 2 æšé­šå¹£ã€‚");
        } else { alert("éŒ¯èª¤ã€‚é€²å…¥ä¸‹ä¸€é¡Œã€‚"); }
        currentQuiz++; showQuestion();
    }

    function finishMarket() {
        document.getElementById('quiz-story').innerText = "æŒ‘æˆ°çµæŸï¼æ°´çºè£ç¸«å¸«èªå¯äº†ä½ çš„èª æ„ã€‚";
        document.getElementById('quiz-question').innerHTML = `
            <div style="background:#111; border:1px solid #333; padding:15px; text-align:left; font-size:14px; line-height:1.6;">
                æœ€çµ‚ç²å¾—äº† <span style="color:#fff; font-size:20px;">${coins}</span> æšé­šå¹£ã€‚<br><br>
                <strong style="color:#fff;">ğŸ« é»‘å¸‚åŠ æ¬ŠæŠ½çèªªæ˜ï¼š</strong><br>
                1 æšé­šå¹£ = 1 æ¬¡æŠ½çæ©Ÿæœƒã€‚é­šå¹£è¶Šå¤šï¼Œåå­—åœ¨æŠ½çç®±ä¸­å‡ºç¾æ¬¡æ•¸è¶Šå¤š~<br><br>
                è«‹å‰å¾€è¡¨å–®ç™»è¨˜ï¼Œé€¾æœŸæœªç™»è¨˜å°‡è¦–åŒæ”¾æ£„æŠ½çè³‡æ ¼ã€‚
            </div>
        `;
        document.getElementById('quiz-options').innerHTML = `
            <button class="option-btn" style="background:#fff; color:#000; text-align:center; font-weight:bold;" onclick="submitCoins()">
                é ˜å–çå‹µä¸¦ç™»è¨˜æŠ½ç / CLAIM REWARD
            </button>
        `;
    }

    function submitCoins() {
        const verifyCode = (coins * 17) + 211; 
        const url = `${BLACK_MARKET_FORM_URL}?usp=pp_url&entry.94782409=${coins}&entry.1993098186=${verifyCode}`;
        window.open(url);
    }

    function confirmCloseMarket() {
        if (confirm("é›¢é–‹é»‘å¸‚å¾Œå°‡ç„¡æ³•å†æ¬¡é€²å…¥ï¼Œç¢ºå®šé›¢é–‹ï¼Ÿ")) {
            document.getElementById('black-market-overlay').style.display = 'none';
        }
    }

    function manualRefresh() { syncStock(); alert("åº«å­˜å·²æ›´æ–°ï¼"); }

    // --- 6. é é¢å•Ÿå‹• ---
    window.onload = () => {
        if (new Date().getTime() >= CLOSE_DATE) {
            document.getElementById('closed-message').style.display = 'flex';
        }
        initMode();
        syncStock();
    };
</script>
</body>
</html>






