<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DINO'S ATELIER | MAGAZINE SHOP</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&display=swap" rel="stylesheet">
    <style>
        h2 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 42px;
            letter-spacing: 5px;
            text-transform: uppercase;
        }
        body { 
            background-color: #FAF9F6; 
            color: #333333; 
            font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; 
            margin: 0; 
            padding-bottom: 100px; 
        }
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; text-align: center; }

        /* ç‹€æ…‹æ¬„ */
        .status-bar { 
            position: fixed; top: 0; width: 100%; 
            background: rgba(255, 255, 255, 0.95); 
            padding: 12px 0; z-index: 1000; 
            border-bottom: 1px solid #eee;
            display: flex; justify-content: space-around; align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .back-home-btn { 
            background: transparent; color: #555; border: 1px solid #ccc; 
            padding: 5px 15px; border-radius: 20px; text-decoration: none; font-size: 13px; 
        }
        .back-home-btn:hover { border-color: #d4af37; color: #d4af37; }

        .coin-display { font-size: 16px; font-weight: bold; color: #333; }

        /* æ›´æ–°æŒ‰éˆ• */
        .refresh-btn {
            background: #fff; color: #333; border: 1px solid #333; padding: 5px 12px;
            border-radius: 6px; font-size: 12px; cursor: pointer; transition: 0.3s;
            display: flex; align-items: center; gap: 5px;
        }
        .refresh-btn:hover { background: #333; color: #fff; }

        .header-section { margin-top: 100px; margin-bottom: 30px; }
        .price-tag { color: #b8860b !important; font-weight: bold; font-size: 14px; }

        /* ç…§ç‰‡å¡ç‰‡ */
        .magazine-gallery { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; padding: 10px; }
        .magazine-card { 
            background: #ffffff; 
            border-radius: 12px; 
            overflow: hidden; 
            border: 1px solid #eee; 
            transition: 0.3s; 
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            position: relative;
        }
        .magazine-card:hover { transform: translateY(-8px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); border-color: #d4af37; }
        .magazine-card img { width: 100%; height: auto; display: block; }
        
        .card-info { padding: 15px; background: #ffffff; border-top: 1px solid #eee; text-align: center; }
        .buy-tag { 
            color: #333333; 
            font-weight: 800; 
            font-size: 14px;
            letter-spacing: 1px;
            display: block;
            margin-bottom: 5px;
        }
        .stock-label { font-size: 12px; color: #888; }
        .stock-count { font-weight: bold; color: #d9534f; }

        /* å”®ç½„è¦†è“‹ */
        .sold-out { opacity: 0.5; filter: grayscale(1); pointer-events: none; }
        .sold-out-badge { 
            position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%) rotate(-15deg); 
            background: rgba(217, 83, 79, 0.9); color: white; padding: 8px 16px; 
            border: 2px solid white; font-weight: bold; z-index: 10; border-radius: 4px; display: none; 
        }

        /* æ¸¬é©—å½ˆçª—æ¨£å¼ */
        #black-market-overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.98); z-index:2000; overflow-y:auto; }
        .quiz-container { max-width: 600px; margin: 40px auto; text-align: center; padding: 20px; color: white; }
        .option-btn { display: block; width: 100%; padding: 15px; margin: 10px 0; background: #252525; color: #fff; border: 1px solid #444; border-radius: 10px; cursor: pointer; text-align: left; }
        #floating-market-btn { position: fixed; bottom: 30px; right: 30px; background: #ff4b4b; color: white; border: none; padding: 15px 25px; border-radius: 50px; font-weight: bold; cursor: pointer; z-index: 1500; display: none; box-shadow: 0 4px 15px rgba(255, 75, 75, 0.3); }
        .dev-badge { position: fixed; top: 70px; right: 10px; background: #333; color: #fff; padding: 5px; border-radius: 5px; font-size: 10px; cursor: pointer; z-index: 2000; }
    </style>
</head>
<body>

<div class="status-bar">
    <a href="index.html" class="back-home-btn">â† å›åˆ°é¦–é </a>
    <div class="coin-display">æŒæœ‰é­šå¹£: <span id="coin-count">0</span> ğŸŸ</div>
    <button id="refresh-data" class="refresh-btn" onclick="fetchStockData()">
        <span>ğŸ”„</span> æ›´æ–°åº«å­˜
    </button>
</div>

<div class="container">
    <div class="header-section">
        <h2 style="letter-spacing: 4px; font-weight: 900;">[ DINO 27TH BIRTHDAY ]</h2>
        <p>é»æ“Šä¸‹æ–¹ç…§ç‰‡å³å¯é€²è¡Œè¨‚è³¼ç™»è¨˜</p>
        <p class="price-tag">æ¯å¥—éœ€æ¶ˆè€— 3 é­šå¹£ï¼Œä¹Ÿè«‹æ³¨æ„æ°´çºå°ºå¯¸!</p>
    </div>
    <div id="magazine-gallery" class="magazine-gallery"></div>
</div>

<button id="floating-market-btn" onclick="openMarket()">{ é€²å…¥é»‘å¸‚æŒ‘æˆ° }</button>

<div id="black-market-overlay">
    <div class="quiz-container">
        <div id="quiz-coin-board" style="display: flex; justify-content: space-between; background: #ffffff; padding: 15px 25px; border-radius: 15px; margin-bottom: 25px; color: #000;">
            <div style="text-align: left;"><span style="color: #888; font-size: 12px; font-weight: bold;">åŸæœ¬é­šå¹£</span><br><span id="quiz-orig-coins" style="font-size: 20px; font-weight: 900;">0</span> ğŸŸ</div>
            <div style="text-align: right;"><span style="color: #666; font-size: 12px; font-weight: bold;">ç²å¾—çå‹µ</span><br><span id="quiz-temp-coins" style="font-size: 20px; font-weight: 900;">0</span> ğŸŸ</div>
        </div>
        <p id="quiz-story" style="color:#ffd026; font-style:italic; margin-bottom:10px;"></p>
        <p id="quiz-question" style="font-size:22px; font-weight:bold; margin-bottom:30px; color:#fff;"></p>
        <div id="quiz-options"></div>
        <p id="quiz-leave" onclick="handlePenaltyClose()" style="margin-top:50px; color:#888; cursor:pointer; text-decoration:underline;">LEAVE MARKET</p>
    </div>
</div>

<script>
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTwOll10EJ23JtCAxUzRtOY6r8yW0yc0Tgn9TyuloPl4pR1lPuuVK5iOpV1KmAkaY4kSq1Jcj6OiQP0/pub?gid=488908997&single=true&output=csv";
    const OPEN_DATE = new Date("Feb 08, 2026 10:00:00").getTime();
    
    // Google è¡¨å–®é€£çµè¨­å®š
    const BASE_FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLScWck40_ZDTAutZ6PT6cq3koXbHUyplsl8lcoASe2ACTlZXOg/viewform?usp=pp_url";
    const BLACK_MARKET_BASE_URL = "https://docs.google.com/forms/d/e/1FAIpQLScv7hqzJEcDXYX7BpIEfs5c2NmNfLOpUnWIxa1blxE9gU9afw/viewform?usp=pp_url";
    const GITHUB_ASSETS = "https://raw.githubusercontent.com/jenny7824212-stack/Dino-Happy-Birthday/main/";

    let coins = parseInt(localStorage.getItem('dino_coins')) || 3;
    let temporaryCoins = 0;
    let currentQuiz = -1;
    let showingStory = true;

    const urlParams = new URLSearchParams(window.location.search);
    const isDeveloper = urlParams.get('dev') === 'otter921008';

    const questions = [
    { 
        story: "ã€Œ Dino åˆå¢åŠ ä¸€æ­²äº†å‘¢ï¼Œè¼¸å…¥æ•¸å­—é€²å…¥é»‘å¸‚å§ã€‚ã€<br><span style='font-size: 13px; color:#fac12f; opacity: 0.8;'>â€”â€” é€™ä¸€å¤©å…‹æ‹‰éƒ½æœŸå¾…ç›´æ’­è¦‹åˆ°çºã€‚</span>",
        q: "å•é¡Œ 1ï¼šæç‡¦çš„ç”Ÿæ—¥æ˜¯å¹¾è™Ÿ?", 
        a: ["2/10", "2/11", "2/12", "3/11"], 
        correct: 1 
    },
    { 
        story: "ã€Œ ä½ æ³¨æ„åˆ°äº†ä¸€å€‹æ­£åœ¨æ’­æ”¾çš„æ”¶éŸ³æ©Ÿã€‚ã€<br><span style='font-size: 13px; color:#fac12f; opacity: 0.8;'>â€”â€” æç‡¦çš„æ—¥æ–‡é›»å°ç¸½æ˜¯å¾ˆæœ‰è¶£ï¼Œè€Œä¸”å­¸ç¿’æ—¥æ–‡ååˆ†åŠªåŠ›å‘¢ã€‚</span>",
        q: "å•é¡Œ 2ï¼šæç‡¦ä¸»æŒçš„SCHOOL OF LOCK æ˜¯å›ºå®šæ¯å€‹æœˆç¬¬å¹¾é€±æ›´æ–°?", 
        a: ["1", "2", "3", "4"], 
        correct: 1 
    },
    { 
        story: "ã€Œ å•†äººè²©è³£åœ‹ç‹è®€æ›¸æ™‚æœŸçš„ç›¸é—œæƒ…å ±ã€‚ã€<br><span style='font-size: 13px; color:#fac12f; opacity: 0.8;'>â€”â€” æç‡¦é–‹å¿ƒé–‹ç›´æ’­æ‹¿è‘—ç•¢æ¥­è­‰æ›¸ï¼Œååˆ†é©•å‚²ã€‚</span>",
        q: "å•é¡Œ 3ï¼šæç‡¦æˆå¹´é«˜ä¸­ç•¢æ¥­çš„Soloæ›²æ˜¯?", 
        a: ["Wait", "Last Order", "Zero", "High Five"], 
        correct: 2 
    },
    { 
        story: "ã€Œ ä½ é€²å…¥ä¸€é–“é…’é¤¨ï¼Œé…’ä¿èªªåªè¦å›ç­”å•é¡Œæ­£ç¢ºï¼Œèƒ½æä¾›2023å¹´çš„ç´…é…’çµ¦ä½ ã€‚ã€<br><span style='font-size: 13px; color:#fac12f; opacity: 0.8;'>â€”â€” Wait é€£çºŒæ‹æ”24å°æ™‚çœŸçš„å¥½è¾›è‹¦ï¼Œä½†å“¥å“¥å€‘éƒ½ä¾†åŠ æ²¹äº†ã€‚</span>",
        q: "å•é¡Œ 4ï¼šã€ŠWaitã€‹èŠ±çµ® MVæ‹æ”æ™‚,æœ‰å¹¾ä½å“¥å“¥åˆ°å ´åŠ æ²¹?", 
        a: ["10", "11", "12", "13"], 
        correct: 2 
    },
    { 
        story: "ã€Œ ä½ åœ¨é»‘å¸‚æ‰¾åˆ°ä¸€å¼µåœ°åœ–ï¼Œç™¼ç¾é»‘å¸‚åˆ†æˆäº†ä¸‰å€ã€‚ã€<br><span style='font-size: 13px; color:#fac12f; opacity: 0.8;'>â€”â€” Wait é‚„å¾—æ›åœ°æ–¹æ‹æ”ï¼Œæœ€å¾Œçš„ä½œå“çœŸçš„è¶…å¥½çœ‹åã€‚</span>",
        q: "å•é¡Œ 5ï¼šæ‹æ” wait MV ä»¥ä¸‹éæ‹æ”åœ°é»?", 
        a: ["é¾è·¯å€", "å»£æ´¥å€", "é¾å±±å€", "æ¾å³¶"], 
        correct: 2 
    },
    { 
        story: "ã€Œ è·¯é‚Šçš„å’–å•¡å»³çª—å£ï¼Œç•™è‘—ä¸€å¼µè™Ÿç¢¼ç‰Œã€‚ã€<br><span style='font-size: 13px; color:#fac12f; opacity: 0.8;'>â€”â€” æœ€å¾Œä¸€å¹•ç´…è‰²æ¯›è¡£çš„ç‡¦ï¼Œå¿ƒç¸½æ˜¯åœ¨é‚£ç©ºäº†ä¸€æ‹ã€‚</span>",
        q: "å•é¡Œ 6ï¼šåœ¨wait MVä¸­æç‡¦çš„è™Ÿç¢¼ç‰Œæ˜¯å¹¾è™Ÿ?", 
        a: ["365", "211", "526", "214"], 
        correct: 0 
    },
    { 
        story: "ã€Œ ä½ åœ¨é»‘å¸‚é‡åˆ°äº†ä¸€ä½è€å¥¶å¥¶ï¼Œå¥¹æ‹¿äº†ä¸€ç›’é†¬èŸ¹é¼“å‹µä½ ã€‚ã€<br><span style='font-size: 13px; color:#fac12f; opacity: 0.8;'>â€”â€” æç‡¦å¥¶å¥¶çš„é†¬èŸ¹ï¼Œç‡¦ä¸€çœ¼å°±çŸ¥é“æ˜¯å“ªå€‹ã€‚</span>",
        q: "å•é¡Œ 7ï¼šæç‡¦å¥¶å¥¶çš„é†¬èŸ¹æ˜¯å“ªè£¡çš„é¢¨æ ¼?", 
        a: ["æ…¶å°šé“", "æ±ŸåŸé“", "å¿ æ¸…é“", "å…¨ç¾…é“"], 
        correct: 3 
    },
    { 
        story: "ã€Œ æ‰¾åˆ°äº†ä»¥å‰åœ‹ç‹æ‹æ”çš„ç¶œè—ç‰‡æ®µï¼Œæ‰®æ¼”å¤§å”çœŸçš„å¥½åƒã€‚ã€<br><span style='font-size: 13px; color:#fac12f; opacity: 0.8;'>â€”â€” é™¤äº†èˆå°ï¼Œæç‡¦çš„æ¼”æŠ€çœŸçš„å¥½å²å®³ã€‚</span>",
        q: "å•é¡Œ 8ï¼šä¸‹åˆ—å“ªä¸€å€‹ä¸æ˜¯éµäººå¤§å”åº•ä¸‹è—äºº?", 
        a: ["è¶™ä¹™å¥½", "Charles", "ç¢©ç‰", "Leo"], 
        correct: 0 
    },
    { 
        story: "ã€Œ å­æ°‘éƒ½çŸ¥é“åœ‹ç‹çš„å•Ÿè’™å¶åƒæ˜¯éº¥å¯Â·å‚‘å…‹æ£®ã€‚ã€<br><span style='font-size: 13px; color:#fac12f; opacity: 0.8;'>â€”â€” ç‡¦çœŸçš„æˆç‚ºäº†éå¸¸è€€çœ¼çš„æ˜æ˜Ÿå‘¢ã€‚</span>",
        q: "å•é¡Œ 9ï¼šåœ¨æèŒ‚çServiceä¸­ï¼Œå”±çš„æ˜¯éº¥å¯çš„å“ªé¦–æ­Œæ›²?", 
        a: ["Beat It", "Thriller", "Billie Jean", "Heal The World"], 
        correct: 3 
    },
    { 
        story: "ã€Œ ç™¼ç¾ä¸€é–“æœé£¾åº—ï¼Œæ›è‘—åœ‹ç‹åœ¨ RIGHT HERE æ¼”å”±æœƒçš„æœé£¾ã€‚ã€<br><span style='font-size: 13px; color:#fac12f; opacity: 0.8;'>â€”â€” é›–ç„¶å¾ˆæ¼‚äº®ï¼Œä½†å»è¨­è¨ˆä¸è‰¯å—å‚·äº†ã€‚</span>",
        q: "å•é¡Œ 10ï¼šé«˜é™½å ´Rainèˆå°ç¬¬ä¸€å¤©èˆ‡ç¬¬äºŒå¤©è¡¨æ¼”æœ‰ä½•ä¸åŒ?", 
        a: ["é‹å­", "æ‰‹å¥—", "è‡‚ç’°", "éº¥å…‹é¢¨"], 
        correct: 2 
    },
    { 
        story: "ã€Œ åœ‹ç‹æ¯æ¬¡è¦‹å­æ°‘æ™‚ï¼Œéƒ½æœƒåšç‰¹æ®Šé€ å‹ï¼ŒæŸ“é«®ã€ç‡™é«®ã€ç•™é•·....é‚„æœ‰ç‰™é‘½ã€‚ã€<br><span style='font-size: 13px; color:#fac12f; opacity: 0.8;'>â€”â€” ç¬‘çš„æ™‚å€™æœƒéœ²å‡ºç‰™é‘½ï¼Œé‚„æœƒä¸å¥½æ„æ€é®ä½ã€‚</span>",
        q: "å•é¡Œ 11ï¼šæç‡¦åœ¨face the sun åšäº†ç‰™é‘½é€ å‹ï¼Œåšäº†å¹¾é¡†ç‰™?", 
        a: ["2", "3", "4", "5"], 
        correct: 1 
    },
    { 
        story: "ã€Œ æ”å½±æ©Ÿåœæ ¼åœ¨ä¸€å€‹ç§‹æ—¥èƒŒæ™¯ä¸‹ï¼Œæ˜¯èˆ‡æˆå“¡å…±èˆçš„ç·šæ¢ã€‚ã€<br><span style='font-size: 13px; color:#fac12f; opacity: 0.8;'>â€”â€” ç‡¦å¹«æˆå“¡è¨­è¨ˆèˆè¹ˆçœŸçš„ç‰¹åˆ¥é©åˆã€‚</span>",
        q: "å•é¡Œ 12ï¼šDanceologyä¸­,å’ŒçŸ¥ç§€åœ¨å“ªè£¡æ‹æ”çš„?", 
        a: ["æ±äº¬", "å¤§é˜ª", "é¦–çˆ¾", "åå¤å±‹"], 
        correct: 3 
    },
    { 
        story: "ã€Œ æ‰¾åˆ°åœ‹ç‹é æ¸¡æµ·æ´‹ï¼Œç¨è‡ªç«™ä¸Šèˆå°çš„ç…§ç‰‡ã€‚ã€<br><span style='font-size: 13px; color:#fac12f; opacity: 0.8;'>â€”â€” æ·±å¤œçœ‹è‘—ç›´æ’­ï¼ŒçœŸçš„å¾ˆé–‹å¿ƒã€‚</span>",
        q: "å•é¡Œ 13ï¼š2025ç¨è‡ªä¸€äººå‡ºåœ‹è¡¨æ¼”æ˜¯å»å“ªè£¡?", 
        a: ["æ—¥æœ¬", "ç¾åœ‹", "æ²™çƒåœ°é˜¿æ‹‰ä¼¯", "æ³•åœ‹"], 
        correct: 2 
    },
    { 
        story: "ã€Œ ç‰†ä¸Šè²¼æ»¿äº†å„é¡ Challenge çš„åˆä½œè¨˜éŒ„ã€‚ã€<br><span style='font-size: 13px; color:#fac12f; opacity: 0.8;'>â€”â€” æç‡¦è·³ä»»ä½•èˆè¹ˆéƒ½å®Œç¾æ¶ˆåŒ–ã€‚</span>",
        q: "å•é¡Œ 14ï¼š2025å¹´å…±æœ‰å¹¾æ¬¡éšŠå¤– Challenge åˆä½œ?", 
        a: ["4 æ¬¡", "5 æ¬¡", "6 æ¬¡", "7 æ¬¡"], 
        correct: 2 
    },
    { 
        story: "ã€Œ æŠ½å±œè£¡æœ‰ä¸€å¼µè¨˜éŒ„è‘—åœ‹ç‹æ­·å¹´ç”Ÿæ—¥å›é¡§çš„æ¸…å–®ã€‚ã€<br><span style='font-size: 13px; color:#fac12f; opacity: 0.8;'>â€”â€” ç”Ÿæ—¥ç›´æ’­çš„è›‹ç³•éƒ½å¾ˆå¯æ„›ï¼Œä½†æ„Ÿè¦ºä¸å¥½åƒã€‚</span>",
        q: "å•é¡Œ 15ï¼šå“ªä¸€å¹´çš„ç”Ÿæ—¥ç›´æ’­åšäº† danceology çš„å›é¡§?", 
        a: ["2018", "2019", "2020", "2021"], 
        correct: 3 
    },
    { 
        story: "ã€Œ æ¡Œä¸Šæ“ºæ”¾åœ‹ç‹è¡¨æ¼”çš„èˆè¹ˆç…§ç‰‡ï¼Œå…¶ä¸­åä¸‰æœˆçš„èˆç™½è‰²çš„å¤–è¢ï¼Œç‰¹åˆ¥åƒæœˆå…‰ä¸‹çš„ä»™å­ã€‚ã€<br><span style='font-size: 13px; color:#fac12f; opacity: 0.8;'>â€”â€” é€™é¦–æ­Œçš„æ­Œè©çœŸçš„ååˆ†å„ªç¾ã€‚</span>",
        q: "å•é¡Œ 16ï¼šåä¸‰æœˆçš„èˆèººè‘—éƒ¨åˆ†ï¼Œæç‡¦å¾ä¸Šé¢æ•¸ä¾†ç¬¬å¹¾å±¤?", 
        a: ["1", "2", "3", "4"], 
        correct: 1 
    },
    { 
        story: "ã€Œ æ›è‘—çš„å¤–å¥—å£è¢‹è£¡å‚³ä¾†äº†å¥³åœ˜çš„æ­Œæ›²æ—‹å¾‹ã€‚ã€<br><span style='font-size: 13px; color:#fac12f; opacity: 0.8;'>â€”â€” ç¶œè—é–‹å¿ƒè·³è‘—å‰è¼©çš„èˆè¹ˆï¼Œç‰¹åˆ¥å¯æ„›ã€‚</span>",
        q: "å•é¡Œ 17ï¼šæç‡¦æ˜¯å“ªä¸€å¥³åœ˜çš„ç²‰çµ²?", 
        a: ["Apink", "f(x)", "EXID", "2NE1"], 
        correct: 0 
    },
    { 
        story: "ã€Œ æœ€å¾Œï¼Œä½ ç™¼ç¾äº†ä¸€æœ¬æ‰‹ç¹ªçš„ã€Šæ°´çºè§€å¯Ÿæ—¥è¨˜ã€‹ã€‚ã€<br><span style='font-size: 13px; color:#fac12f; opacity: 0.8;'>â€”â€” æ„Ÿè¬èµ°åˆ°é€™è£¡ã€‚</span>",
        q: "ç‰¹åˆ¥å•é¡Œï¼šä»¥ä¸‹å“ªä¸€å€‹ã€Œæ²’æœ‰ã€è¢«æ”¶éŒ„åœ¨æ—¥è¨˜ä¸­?", 
        a: ["é¼“å˜´", "æ‚è‡‰", "éœ²é½’ç¬‘", "çœ¼é¡"], 
        correct: 3 
    }
    ];

    window.onload = function() {
        const gallery = document.getElementById('magazine-gallery');
        for (let i = 1; i <= 10; i++) {
            const card = document.createElement('div');
            card.className = 'magazine-card';
            card.id = `card-${i}`;
            card.onclick = () => handlePurchase(i);
            card.innerHTML = `
                <div id="badge-${i}" class="sold-out-badge">SOLD OUT</div>
                <img src="${GITHUB_ASSETS}cloth${i}.jpg">
                <div class="card-info">
                    <span class="buy-tag">CLOTH #${i}</span>
                    <span class="stock-label">å‰©é¤˜æ•¸é‡ï¼š<span id="stock-${i}" class="stock-count">--</span></span>
                </div>
            `;
            gallery.appendChild(card);
        }
        updateCoinDisplay();
        fetchStockData();
        checkMarketStatus();
        if (isDeveloper) addDevTool();
    };

    async function fetchStockData() {
        const btn = document.getElementById('refresh-data');
        btn.innerText = "æ›´æ–°ä¸­...";
        try {
            const response = await fetch(`${CSV_URL}&t=${new Date().getTime()}`);
            const data = await response.text();
            const rows = data.split('\n').map(row => row.split(','));

            for (let i = 1; i <= 10; i++) {
                if (rows[i]) {
                    const currentStock = parseInt(rows[i][2]); 
                    document.getElementById(`stock-${i}`).innerText = currentStock;

                    if (currentStock <= 0) {
                        document.getElementById(`card-${i}`).classList.add('sold-out');
                        document.getElementById(`badge-${i}`).style.display = 'block';
                    } else {
                        document.getElementById(`card-${i}`).classList.remove('sold-out');
                        document.getElementById(`badge-${i}`).style.display = 'none';
                    }
                }
            }
        } catch (e) { console.error("æ›´æ–°å¤±æ•—", e); }
        finally { btn.innerHTML = "<span>ğŸ”„</span> æ›´æ–°åº«å­˜"; }
    }

    function updateCoinDisplay() {
        document.getElementById('coin-count').innerText = coins;
    }

    function handlePurchase(itemId) {
        const now = new Date().getTime();
        const stockEl = document.getElementById(`stock-${itemId}`);
        const stock = stockEl ? parseInt(stockEl.innerText) : 0;
        
        if (now < OPEN_DATE && !isDeveloper) { alert("ğŸ”’ 2/8 10:00 æ­£å¼é–‹å•Ÿã€‚"); return; }
        if (stock <= 0) { alert("æ­¤å•†å“å·²å”®ç½„ï¼"); return; }
        if (coins < 3) { alert("é­šå¹£ä¸è¶³ï¼è«‹å‰å¾€é»‘å¸‚ç²å–ã€‚"); return; }

        if (confirm(`æ¶ˆè€— 3 é­šå¹£è³¼è²· [ CLOTH #${itemId} ]ï¼Ÿ\n(æ³¨æ„ï¼šæ¯äººåƒ…é™ç™»è¨˜è³¼è²·ä¸€ä»¶)`)) {
            coins -= 3;
            localStorage.setItem('dino_coins', coins);
            updateCoinDisplay();
            // ä¸€èˆ¬è³¼è²·è¡¨å–®è·³è½‰ï¼šID = 94643144
            window.location.href = `${BASE_FORM_URL}&entry.94643144=%23${itemId}`;
        }
    }

    function checkMarketStatus() {
        const btn = document.getElementById('floating-market-btn');
        const now = new Date().getTime();
        if (isDeveloper || now >= OPEN_DATE) btn.style.display = 'block';
        
        if (localStorage.getItem('dino_market_entered') === 'true') {
            btn.innerHTML = "{ æŒ‘æˆ°å·²çµæŸ }";
            btn.style.background = "#333";
            btn.onclick = () => alert("æŒ‘æˆ°æ©Ÿæœƒåªæœ‰ä¸€æ¬¡ã€‚");
        }
    }

    function openMarket() {
        if (localStorage.getItem('dino_market_entered') === 'true') return;
        if (!confirm("âš ï¸ è­¦å‘Šï¼šé€²å…¥é»‘å¸‚ä¸­é€”é€€å‡ºï¼Œé­šå¹£å°‡é‡ç½®ï¼ä¹Ÿç„¡æ³•å†æ¬¡é€²å…¥ï¼Œç¢ºå®šé€²å…¥ï¼Ÿ")) return;
        localStorage.setItem('dino_market_entered', 'true');
        checkMarketStatus();
        document.getElementById('black-market-overlay').style.display = 'block';
        currentQuiz = -1; temporaryCoins = 0; showQuestion();
    }

    function showQuestion() {
        const storyP = document.getElementById('quiz-story');
        const questionP = document.getElementById('quiz-question');
        const optionsDiv = document.getElementById('quiz-options');
        document.getElementById('quiz-orig-coins').innerText = coins;
        document.getElementById('quiz-temp-coins').innerText = temporaryCoins;

        if (currentQuiz >= questions.length) {
            document.getElementById('quiz-coin-board').style.display = 'none';
            storyP.style.color = "#ffffff"; 
            storyP.style.lineHeight = "1.8";
            storyP.innerHTML = 
                "<span style='color:#ffd026; font-size:18px; font-weight:bold;'>ã€Œä½ æ‰¾åˆ°æç‡¦å„ç¨®é¢è²Œçš„ç¢ç‰‡äº†å‘¢...ã€</span><br>" + 
                "ä½ æ¨é–‹æœè£åº—çš„å¾Œé–€ï¼Œç™¼ç¾äº†è£ç¸«å¸«åœ¨é‚£ç­‰è‘—ä½ ã€‚<br>" +
                "è£ç¸«å¸«èªªï¼šã€Œåœ‹ç‹çš„å„ç¨®é¢è²Œä½ éƒ½ååˆ†äº†è§£...ã€<br>" +
                "ã€Œä¸ç®¡æ˜¯ç¶œè—ã€èˆå°ã€ç›´æ’­...ã€<br>" +
                "<span style='color:#ffd026; font-weight:bold;'>é‚£éº¼å°±å¯«ä¸‹ä½ æƒ³è¦çš„ç¨å±¬æ–¼åœ‹ç‹çš„è¡£æœå§ï¼</span><br>" + 
                "<span style='font-size:13px; color:#bbb;'>è£ç¸«å¸«æ•´ç†ä½ çš„æƒ³æ³•ï¼Œè®“ä½ å¸¶è‘—ä½œå“æˆåŠŸå®Œæˆåœ‹ç‹çš„æ™‚è£ç§€ã€‚</span><br>" + 
                "<hr style='border:0; border-top:1px solid #444; margin:15px 0;'>" + 
                "<span style='font-size:14px; color:#fff;'>ç„¡è«–ç­”å°é¡Œæ•¸å¤šå¯¡ï¼Œéƒ½æ˜¯å› ç‚ºå–œæ„› DINO æ‰æœƒé»é–‹ç¶²é ã€‚</span><br>" +
                "<span style='font-size:14px; color:#bbb;'>ä¸‹é¢è¡¨å–®é™¤äº†æ´»å‹•ç™»è¨˜ï¼Œä¹Ÿå¯ä»¥å¯«é»æ±è¥¿çµ¦æˆ‘ã€‚</span>";
            
            questionP.innerHTML = `
                <div style="background:#fff; padding:20px; border-radius:15px; color:#000; margin-top:20px;">
                    <span style="font-size:14px; color:#666;">ä¾†è‡ªè£ç¸«å¸«çš„è¬ç¦®</span><br>
                    <div style="margin:10px 0; font-size:24px; font-weight:900;">çå‹µï¼š+${temporaryCoins} ğŸŸ</div>
                    <div style="border-top:1px solid #eee; padding-top:10px; font-size:16px;">ç¸½æŒæœ‰é­šå¹£ï¼š${coins + temporaryCoins} ğŸŸ</div>
                </div>`;
            
            optionsDiv.innerHTML = `
                <button class="option-btn" 
                        style="background:#ffd026; color:#000; font-weight:bold; text-align:center; border:none;" 
                        onclick="finalizeMarketCoins()">
                    ç¢ºèªé ˜å–ä¸¦ç™»è¨˜
                </button>`;
            return;
        }

        if (currentQuiz === -1) {
            storyP.innerHTML = "èº«ç‚ºæ°´çºåœ‹ç‹çš„å­æ°‘ï¼Œä½ æ­£ç‚ºäº†åœ‹ç‹çš„æ™‚è£é€±ä¹‹æ—…å¥”æ³¢...<br>è£ç¸«å¸«å¯„å‡ºé‚€è«‹ï¼Œåªè¦å®Œæˆé›£é—œï¼Œä¾¿æœƒå¹«åŠ©ä½ å®Œæˆæœ€é‡è¦çš„æœè£ã€‚";
            questionP.innerHTML = "åœ¨éç¨‹ä¸­äº†è§£æç‡¦çš„é¢è²Œï¼Œæœ€å¾Œæå‡ºå°ˆå±¬è¨­è¨ˆã€‚<br><div style='font-size: 13px; color: #ff6b6b; margin-top: 10px; border: 1px dashed #ff6b6b; padding: 10px;'>âš ï¸ é»‘å¸‚ä¸­è«‹å‹¿é‡æ•´ï¼Œå¦å‰‡å°‡å¤±å»å†æ¬¡é€²å…¥çš„æ©Ÿæœƒï¼</div>";
            optionsDiv.innerHTML = `<button class="option-btn" style="text-align:center; background:#ffd026; color:#000; font-weight:bold;" onclick="currentQuiz=0; showingStory=true; showQuestion();">é–‹å§‹å°‹æ‰¾è£ç¸«å¸«</button>`;
            return;
        }

        const data = questions[currentQuiz];
        if (showingStory) {
            storyP.innerHTML = `<div style="font-size:20px; color:#ffd026; line-height:1.6; margin:40px 0;">ã€Œ ${data.story} ã€</div>`;
            questionP.innerText = "";
            optionsDiv.innerHTML = `<button class="option-btn" style="text-align:center; background:#444;" onclick="showingStory=false; showQuestion();">æŸ¥çœ‹æŒ‘æˆ°é¡Œ â†’</button>`;
        } else {
            storyP.innerHTML = `<div style="color:#888; font-size:14px;">ç¢ç‰‡æ”¶é›†ä¸­...</div>`;
            questionP.innerText = data.q;
            optionsDiv.innerHTML = '';
            data.a.forEach((txt, idx) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = `${String.fromCharCode(65 + idx)}. ${txt}`;
                btn.onclick = () => {
                    if (idx === data.correct) { temporaryCoins += 2; alert("æ­£ç¢ºï¼ç²å¾— 2 é­šå¹£ã€‚"); }
                    else { alert("ç­”éŒ¯äº†...ä½†éˆæ„Ÿä¾ç„¶åœ¨é–ƒçˆï¼Œç¹¼çºŒè¿½è¹¤ã€‚"); }
                    currentQuiz++; showingStory = true; showQuestion();
                };
                optionsDiv.appendChild(btn);
            });
        }
    }

    function handlePenaltyClose() {
        if (confirm("é›¢é–‹é»‘å¸‚ï¼Œé­šå¹£å°‡æ­¸å›åˆå§‹å€¼ (3)ï¼ç¢ºå®šå—ï¼Ÿ")) {
            coins = 3; localStorage.setItem('dino_coins', 3); updateCoinDisplay();
            document.getElementById('black-market-overlay').style.display = 'none';
        }
    }

    function finalizeMarketCoins() {
        const finalCoins = coins + temporaryCoins;
        coins = finalCoins;
        localStorage.setItem('dino_coins', coins);
        updateCoinDisplay();
        // é©—è­‰ç¢¼å…¬å¼
        const verifyCode = (finalCoins * 17) + 211;
        // é»‘å¸‚è¡¨å–®è·³è½‰ï¼šé­šå¹£ ID = 94782409, é©—è­‰ç¢¼ ID = 1993098186
        window.location.href = `${BLACK_MARKET_BASE_URL}&entry.94782409=${finalCoins}&entry.1993098186=${verifyCode}`;
    }

    function addDevTool() {
        const devBtn = document.createElement('div');
        devBtn.className = 'dev-badge'; devBtn.innerText = 'ğŸ› ï¸ DEV';
        devBtn.onclick = () => {
            let cmd = prompt("1.+3 / 2.Reset / 3.Finish");
            if (cmd==='1') { coins+=3; localStorage.setItem('dino_coins', coins); updateCoinDisplay(); }
            if (cmd==='2') { localStorage.setItem('dino_coins', 3); localStorage.removeItem('dino_market_entered'); location.reload(); }
            if (cmd==='3') { currentQuiz = questions.length; showQuestion(); }
        };
        document.body.appendChild(devBtn);
    }
</script>
</body>
</html>




