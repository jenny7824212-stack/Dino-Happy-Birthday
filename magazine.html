<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DINO 27 - LE MARCHÃ‰ NOIR & COLLECTION</title>
    <style>
        body { background: #fff; color: #000; font-family: 'Times New Roman', serif; margin: 0; overflow-x: hidden; }
        header { padding: 40px 20px; text-align: center; border-bottom: 1px solid #000; letter-spacing: 5px; }
        .nav-bar { display: flex; justify-content: space-between; padding: 10px 20px; border-bottom: 1px solid #000; font-size: 12px; position: sticky; top: 0; background: #fff; z-index: 100; }
        
        /* å•†å“ç¶²æ ¼ */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; padding: 20px; }
        .item { border: 1px solid #eee; padding: 15px; text-align: center; position: relative; transition: 0.3s; }
        .item:hover { border-color: #000; }
        .item img { width: 100%; height: auto; filter: grayscale(100%); transition: 0.5s; cursor: pointer; }
        .item img:hover { filter: grayscale(0%); }
        .item h3 { font-size: 16px; margin: 15px 0 5px; letter-spacing: 1px; }
        .item p { font-size: 12px; color: #666; }
        .sold-out { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); color: #fff; display: flex; align-items: center; justify-content: center; letter-spacing: 2px; z-index: 10; pointer-events: none; }

        /* åŒæ­¥æŒ‰éˆ•æ¨£å¼ */
        .refresh-container { text-align: center; margin: 20px 0; }
        #refresh-btn { background: transparent; color: #000; border: 1.5px solid #000; padding: 8px 20px; cursor: pointer; font-family: 'Times New Roman', serif; letter-spacing: 2px; transition: 0.3s; font-size: 13px; }
        #refresh-btn:hover { background: #000; color: #fff; }

        /* é»‘å¸‚æŒ‘æˆ° UI */
        #black-market-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; color: #fff; z-index: 1000; padding: 40px 20px; box-sizing: border-box; overflow-y: auto; }
        .quiz-container { max-width: 600px; margin: 0 auto; }
        .option-btn { display: block; width: 100%; padding: 15px; margin: 10px 0; border: 1px solid #fff; background: transparent; color: #fff; cursor: pointer; text-align: left; transition: 0.3s; }
        .option-btn:hover { background: #fff; color: #000; }
    </style>
</head>
<body>

<header>
    <h1>DINO 27</h1>
    <p>Ã‰DITION LIMITÃ‰E / COLLECTION HIVER</p>
</header>

<div class="nav-bar">
    <div>MONNAIE: <span id="coin-count">3</span> ğŸŸ</div>
    <div id="market-status" style="cursor:pointer; text-decoration: underline;" onclick="openMarket()">LE MARCHÃ‰ NOIR (é€²å…¥é»‘å¸‚)</div>
</div>

<div class="refresh-container">
    <button id="refresh-btn" onclick="manualRefresh()">SYNCHRONISER LES STOCKS (æ›´æ–°åº«å­˜)</button>
</div>

<div class="grid" id="magazine-grid"></div>

<div id="black-market-overlay">
    <div class="quiz-container">
        <h2 id="quiz-title">LE MARCHÃ‰ NOIR</h2>
        <hr border="1" color="#fff">
        <p id="quiz-story" style="font-style: italic; color: #aaa; margin-bottom: 20px; white-space: pre-line;"></p>
        <p id="quiz-question" style="font-size: 18px; line-height: 1.6;"></p>
        <div id="quiz-options"></div>
        <div id="quiz-footer" style="margin-top: 30px; font-size: 12px; color: #666;">
            <span onclick="closeMarket()" style="cursor:pointer;">[ QUITTER / æ’¤é€€ ]</span>
        </div>
    </div>
</div>

<script>
    // ------------------- 1. åŸºç¤é…ç½® -------------------
    // è«‹ç¢ºèªä»¥ä¸‹é€£çµèˆ‡æ‚¨ GitHub åŸæœ¬çš„ä¸€è‡´
    const STOCK_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT5K76YgI8_Llyf8q1D_756jK_C68K66Yv1YmX_I6pG9_I6pG9_I6pG9_I6pG9/pub?gid=0&output=csv'; // ç¯„ä¾‹ï¼Œè«‹æ›¿æ›
    const ORDER_FORM_URL = 'https://docs.google.com/forms/d/e/æ‚¨çš„è¡¨å–®ID/viewform';
    const BLACK_MARKET_FORM_URL = 'https://docs.google.com/forms/d/e/æ‚¨çš„é»‘å¸‚è¡¨å–®ID/viewform';
    
    let coins = 3;
    let inventory = {};
    let currentQuiz = 0;

    // ------------------- 2. åº«å­˜ç®¡ç†ç³»çµ± -------------------
    async function manualRefresh() {
        const btn = document.getElementById('refresh-btn');
        btn.innerText = "SYNCHRONISATION...";
        btn.disabled = true;
        await syncStock();
        setTimeout(() => {
            btn.innerText = "COMPLÃ‰TÃ‰ (å·²æ›´æ–°)";
            setTimeout(() => { btn.innerText = "SYNCHRONISER LES STOCKS (æ›´æ–°åº«å­˜)"; btn.disabled = false; }, 1000);
        }, 500);
    }

    async function syncStock() {
        try {
            const timestamp = new Date().getTime();
            const res = await fetch(`${STOCK_CSV_URL}&t=${timestamp}`);
            const text = await res.text();
            const rows = text.split('\n').filter(row => row.trim() !== '').slice(1);
            
            rows.forEach(row => {
                const cols = row.split(',');
                if (cols.length >= 3) {
                    const id = parseInt(cols[0].trim());
                    let count = parseInt(cols[2].trim()); // è®€å– C æ¬„
                    if (!isNaN(id)) inventory[id] = isNaN(count) ? 0 : count;
                }
            });
            renderGrid();
        } catch (e) { console.error("Sync Error", e); renderGrid(); }
    }

    function renderGrid() {
        const grid = document.getElementById('magazine-grid');
        grid.innerHTML = '';
        for (let i = 1; i <= 16; i++) {
            const stock = inventory[i] !== undefined ? inventory[i] : '...';
            const isSoldOut = (stock !== '...' && stock <= 0);
            const item = document.createElement('div');
            item.className = 'item';
            item.innerHTML = `
                <img src="cloth${i}.jpg" onclick="${isSoldOut ? '' : `orderItem(${i})`}">
                <h3>ITEM #${String(i).padStart(3, '0')}</h3>
                <p>STOCK: ${stock}</p>
                ${isSoldOut ? '<div class="sold-out">SOLD OUT</div>' : ''}
            `;
            grid.appendChild(item);
        }
    }

    function orderItem(id) {
        window.open(`${ORDER_FORM_URL}?entry.12345=ITEM${id}`); // entry ID è«‹è‡ªè¡Œæ›¿æ›
    }

    // ------------------- 3. é»‘å¸‚é¡Œç›®è¨­å®š -------------------
    const questions = [
        { q: "å•é¡Œ 1ï¼šæç‡¦çš„ç”Ÿæ—¥æ˜¯å¹¾è™Ÿï¼Ÿ", a: ["2/10", "2/11", "2/12", "3/11"], correct: 1, story: "ä½ è¢«æ”¾è¡Œäº†ã€‚\nç‰†ä¸Šè²¼è‘—èˆŠæµ·å ±ï¼šã€é¡å­è£¡æ‰€ç…§çš„æˆ‘ååˆ†é™Œç”Ÿã€‚ã€" },
        { q: "å•é¡Œ 2ï¼šæç‡¦æˆå¹´é«˜ä¸­ç•¢æ¥­çš„Soloæ›²æ˜¯ï¼Ÿ", a: ["Wait", "Last Order", "Zero", "High Five"], correct: 2, story: "ç‡¦å™ å“©æƒ³èµ·ç¬¬ä¸€æ¬¡çš„ solo mv æ‹æ”ï¼šã€ä½†ä½ ä¸æ˜¯ä¸€å€‹äººã€‚ã€" },
        { q: "å•é¡Œ 3ï¼šã€ŠWaitã€‹èŠ±çµ® MVæ‹æ”æ™‚ï¼Œæœ‰å¹¾ä½å“¥å“¥åˆ°å ´åŠ æ²¹ï¼Ÿ", a: ["10", "11", "12", "13"], correct: 2, story: "å“¥å“¥å€‘éƒ½ä¾†äº†ï¼å±•ç¤ºæ¶ä¸Šæ”¾è‘—æ¼”å”±æœƒæœè£ã€‚" },
        { q: "å•é¡Œ 4ï¼šRain èˆå°ç¬¬ä¸€å¤©èˆ‡ç¬¬äºŒå¤©æœ‰ä½•è™•ä¸åŒï¼Ÿ", a: ["é‹å­", "æ‰‹å¥—", "è‡‚ç’°", "éº¥å…‹é¢¨"], correct: 2, story: "åœ‹ç‹å¹«å“¥å“¥è¨­è¨ˆèˆè¹ˆã€‚ç§‹å¤©çš„è½è‘‰å¥½å¤šã€‚" },
        { q: "å•é¡Œ 5ï¼šå’ŒçŸ¥ç§€ä¸€èµ·çš„Danceologyæ˜¯åœ¨åå¤å±‹æ‹æ”çš„ï¼Œå°å—ï¼Ÿ", a: ["å°", "ä¸å°", "å¤§é˜ª", "é¦–çˆ¾"], correct: 0, story: "é»‘å¸‚è²éŸ³æ¶ˆå¤±ï¼šã€ç¬¬ä¸€æ¬¡ç¨è‡ªä¸€äººç«™ä¸Šçš„åœ‹éš›èˆå°ï¼Ÿã€" },
        { q: "å•é¡Œ 6ï¼šæç‡¦ä»Šå¹´ç¨è‡ªå‡ºåœ‹è¡¨æ¼”æ˜¯å»ï¼Ÿ", a: ["æ—¥æœ¬", "ç¾åœ‹", "æ²™çƒåœ°(EWC)", "æ³•åœ‹"], correct: 2, story: "é–€å‰çš„äººç¿»è‘—è³‡æ–™ï¼šã€ä»Šå¹´ï¼Œæç‡¦èµ°å‡ºäº†å¤šå°‘æ¬¡éšŠä¼ä»¥å¤–ï¼Ÿã€" },
        { q: "å•é¡Œ 7ï¼šæç‡¦ 2025å¹´å…±æœ‰å¹¾æ¬¡ã€ŒéšŠå¤–ã€åˆä½œï¼Ÿ", a: ["4æ¬¡", "5æ¬¡", "6æ¬¡", "7æ¬¡"], correct: 2, story: "ä½ ä¾†åˆ°æœ€æ·±è™•ã€‚æ¡Œä¸Šæ”¤è‘—ä¸€æœ¬ã€Šæ°´çºè§€å¯Ÿæ—¥è¨˜ã€‹ã€‚" },
        { q: "å•é¡Œ 8ï¼šæ—¥è¨˜ä¸­ã€Œæ²’æœ‰ã€æ”¶éŒ„ä»¥ä¸‹å“ªå€‹å‹•ä½œï¼Ÿ", a: ["é¼“å˜´", "æ‚è‡‰", "éœ²é½’ç¬‘", "çœ¼é¡"], correct: 3, story: "ã€æœ‰ä¸€å€‹é¡è‰²ï¼Œåªæœ‰ä½ èƒ½æ’å¾—ä½ã€‚ã€" },
        { q: "å•é¡Œ 9ï¼šè¨­è¨ˆå¸«æœ€å–œæ­¡æç‡¦çš„å“ªä¸€å€‹é«®è‰²ï¼Ÿ", a: ["é»‘è‰²", "é‡‘è‰²", "ç´…è‰²", "è—è‰²"], correct: 3, story: "é–€ï¼Œåœ¨ä½ é¢å‰æ‰“é–‹ã€‚è¨­è¨ˆå¸«å°±åœ¨è£¡é¢ã€‚" }
    ];

    function openMarket() {
        if (document.getElementById('market-status').innerText.includes('FERMÃ‰')) return;
        document.getElementById('black-market-overlay').style.display = 'block';
        showQuestion();
    }

    function showQuestion() {
        if (currentQuiz >= questions.length) { finishMarket(); return; }
        const data = questions[currentQuiz];
        document.getElementById('quiz-story').innerText = data.story;
        document.getElementById('quiz-question').innerText = data.q;
        const optionsDiv = document.getElementById('quiz-options');
        optionsDiv.innerHTML = '';
        data.a.forEach((txt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = `${String.fromCharCode(65 + idx)}. ${txt}`;
            btn.onclick = () => checkAnswer(idx);
            optionsDiv.appendChild(btn);
        });
    }

    function checkAnswer(idx) {
        if (idx === questions[currentQuiz].correct) {
            coins += 2;
            document.getElementById('coin-count').innerText = coins;
            currentQuiz++;
            showQuestion();
        } else {
            alert("å›ç­”éŒ¯èª¤ï¼ä½ è¢«é»‘å¸‚ä¿å…¨è¶•äº†å‡ºä¾†ã€‚");
            closeMarket();
        }
    }

    function finishMarket() {
        document.getElementById('quiz-title').innerText = "VÃ‰RIFICATION TERMINÃ‰E";
        document.getElementById('quiz-question').innerText = `æ­å–œé€šé—œï¼ä½ ç¸½å…±ç²å¾—äº† ${coins} æšé­šå¹£ã€‚`;
        document.getElementById('quiz-options').innerHTML = `<button class="option-btn" onclick="submitCoins()">æäº¤é­šå¹£ä¸¦é ˜å–çå‹µ</button>`;
    }

    function submitCoins() {
        const verifyCode = Math.floor(Math.random() * 90000) + 10000;
        window.open(`${BLACK_MARKET_FORM_URL}?entry.111=${coins}&entry.222=${verifyCode}`);
    }

    function closeMarket() {
        document.getElementById('black-market-overlay').style.display = 'none';
        currentQuiz = 0;
        coins = 3;
        document.getElementById('coin-count').innerText = coins;
        document.getElementById('market-status').innerText = "LE MARCHÃ‰ NOIR (FERMÃ‰)";
        document.getElementById('market-status').style.color = "#999";
    }

    // åˆå§‹åŒ–åŒæ­¥
    syncStock();
</script>
</body>
</html>
